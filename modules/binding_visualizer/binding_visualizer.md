# Binding Visualizer Module

## Overview

The Binding Visualizer module is designed to fetch and visualize Protein Data Bank (PDB) structures using the `py3Dmol` library. This module consists of a Python script, a configuration file, and an HTML file for visualization output.

## Components

### 1. Python Script (`binding_visualizer.py`)

This script contains the main logic for fetching PDB data and visualizing it. The key functions and their purposes are:

- **`fetch_pdb_data(pdb_id)`**: Fetches PDB data for a given PDB ID from the RCSB PDB database.
  - **Arguments**: `pdb_id` (str) - The PDB ID of the structure to be fetched.
  - **Returns**: PDB file data as a string if the request is successful.
  - **Raises**: `requests.exceptions.RequestException` if an error occurs during the request.

- **`visualize_structure(pdb_data, width, height, chain_style, residue_style, output_html)`**: Visualizes the PDB structure using `py3Dmol`.
  - **Arguments**:
    - `pdb_data` (str) - The PDB data string that contains the molecular structure.
    - `width` (int) - Width of the viewer window.
    - `height` (int) - Height of the viewer window.
    - `chain_style` (dict) - Visualization style for the chain.
    - `residue_style` (dict) - Visualization style for the residue.
    - `output_html` (str) - Path to the output HTML file to save the visualization.

- **`main()`**: The main function to execute the PDB data fetching and visualization workflow.
  - Initializes logging configuration.
  - Fetches the PDB data using `fetch_pdb_data`.
  - Visualizes the data using `visualize_structure`.
  - Handles any exceptions, logs errors, and prints a traceback for debugging.

### 2. Configuration File (`binding_visualizer.yaml`)

This YAML file contains configuration settings for the module. The settings include:

- **`pdb_id`**: The PDB ID of the structure to be visualized.
- **`viewer`**: Settings for the viewer dimensions.
  - `width`: Width of the viewer window.
  - `height`: Height of the viewer window.
- **`visualization`**: Visualization styles for different parts of the molecule.
  - `chain_style`: Visualization style for the chain.
  - `residue_style`: Visualization style for the residue.

### 3. HTML File (`5LF3_structure_viewer.html`)

This HTML file is generated by the `visualize_structure` function and contains the visualization of the PDB structure. It includes:

- A `div` element to hold the 3Dmol.js viewer.
- A script to load the 3Dmol.js library and initialize the viewer with the specified PDB data and styles.

## Enhanced Output Features

The generated HTML now includes:

- **PDB Metadata**: Title, experimental method, resolution, ligands, and chains (parsed from the PDB header).
- **Viewer and Visualization Settings**: Viewer size, chain and residue styles.
- **Provenance & Reproducibility**:
  - Script and config SHA256 hashes
  - Git commit hash (if available)
  - Download timestamp (UTC)
  - Inline YAML config (expandable)
  - Download links for PDB and YAML config
- **Environment Info**: Python version, platform, user/host, dependency versions
- **Instructions**: How to interact with the viewer
- **Attribution**: Script name, contact, copyright

### Example Info Block (HTML)

```html
<div style='font-family: Arial, ...'>
  <h2>PDB Structure Viewer</h2>
  <div><b>PDB ID:</b> <a href='https://www.rcsb.org/structure/5LF3'>5LF3</a></div>
  <div><b>Title:</b> HUMAN 20S PROTEASOME COMPLEX WITH BORTEZOMIB AT 2.1 ANGSTROM</div>
  <div><b>Experimental Method:</b> X-RAY DIFFRACTION</div>
  <div><b>Resolution:</b> 2.1 A</div>
  <div><b>Ligands:</b> BOR</div>
  <div><b>Chains:</b> A, O</div>
  <div><b>Viewer size:</b> 800 x 600</div>
  <div><b>Chain style:</b> {"stick": {}}</div>
  <div><b>Residue style:</b> {"stick": {"colorscheme": "cyanCarbon"}}</div>
  <div><b>Generated:</b> 2025-05-30 11:38:17</div>
  <div><b>Script:</b> binding_visualizer.py</div>
  <div><b>Config file:</b> binding_visualizer.yaml</div>
  <div><b>Python version:</b> 3.9.6</div>
  <div><b>Platform:</b> Darwin 24.5.0</div>
  <div><b>User/Host:</b> user@host</div>
  <div><b>PDB Downloaded:</b> 2025-05-30 11:38:17 UTC</div>
  <div><b>Script SHA256:</b> ...</div>
  <div><b>Config SHA256:</b> ...</div>
  <div><b>Instructions:</b> Drag to rotate, scroll to zoom, double-click to center. Hover over atoms for details.</div>
  <div><b>Dependencies:</b> py3Dmol 2.4.2, requests 2.32.3, pyyaml 6.0.2</div>
  <div><b>Git commit:</b> 453cabf</div>
  <div><b>Downloads:</b> <a href='https://files.rcsb.org/download/5LF3.pdb'>PDB file</a> | <a href='binding_visualizer.yaml'>YAML config</a></div>
  <details><summary>Show YAML Config</summary><pre>...</pre></details>
  <div style='font-size: 12px; color: #888;'>Visualization generated by <b>binding_visualizer.py</b> using <b>py3Dmol</b>.<br>Contact: <a href='mailto:your.email@example.com'>your.email@example.com</a><br>Copyright &copy; 2025</div>
</div>
```

### How to Use

1. Edit `binding_visualizer.yaml` to set your PDB ID and visualization preferences.
2. Run `python binding_visualizer.py`.
3. Open the generated HTML file in your browser.

### Scientific Reproducibility

- All key settings, hashes, and provenance info are included in the HTML for compliance and reproducibility.
- The YAML config is inlined and downloadable.
- The script and config hashes ensure immutability.

---

For further enhancements (e.g., citation, validation, or interaction tables), see the script for extension points.

## Workflow

1. **Configuration Loading**: The script loads configuration settings from the `binding_visualizer.yaml` file.
2. **PDB Data Fetching**: The `fetch_pdb_data` function fetches the PDB data for the specified PDB ID.
3. **Structure Visualization**: The `visualize_structure` function visualizes the fetched PDB data using `py3Dmol` and saves the output as an HTML file.
4. **Error Handling**: Any exceptions during the workflow are logged, and a traceback is printed for debugging.

## Usage

To use the Binding Visualizer module, follow these steps:

1. Ensure that the required libraries (`py3Dmol`, `requests`, `colorama`, `yaml`) are installed.
2. Update the `binding_visualizer.yaml` file with the desired PDB ID and visualization settings.
3. Run the `binding_visualizer.py` script to fetch and visualize the PDB structure.
4. Open the generated HTML file in a web browser to view the visualization.

```bash
python binding_visualizer.py
```

## Conclusion

The Binding Visualizer module provides a streamlined way to fetch and visualize PDB structures using `py3Dmol`. By configuring the settings in the YAML file, users can customize the visualization to suit their needs.
